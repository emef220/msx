1 ' Copyright (c) 2	023 emef220 
2 ' Released under the MIT license
3 ' https://opensource.org/licenses/mit-license.php
401 CLS
411 FR%=15:CP%=0
412 D=0:W=1
420 COLOR15,0,0:SCREEN5
421 VDP(0)=0:VDP(1)=&H68:VDP(10)=VDP(10) AND &H7F
422 BASE(15)=0:BASE(17)=&H800:T=1
423 VDP(2)=0:VDP(4)=T
424 VDP(9)=VDP(9) OR &H22
425 DEFUSR=&H41:A=USR(0)

431 D=0:W=0:POKE&HFAF6,W
432 I=1+CP%:FL$=MID$(STR$(I),2):BLOAD FL$,S:I=3+I:FL$=MID$(STR$(I),2):BLOAD FL$,S:GOSUB3000
433 DEFUSR=&H44:A=USR(0) 

450 'SET PALLET
460 GOSUB 3000

480 'INTERVAL ON
485 T=1+CP%:ONINTERVAL=FR%GOSUB500:INTERVALON
490 IFINKEY$=""GOTO490 ELSE END

500 VDP(4)=TMOD32
511 T=T+1
512 GOSUB700
520 RETURN

700 IF T=316 THEN POKE&HFAF6,0:CP%=0:T=CP%+1:FL$=MID$(STR$(T),2):BLOAD FL$,S:GOSUB3000:RETURN
705 GOSUB 800
720 RETURN

800 IF TMOD4=0 THEN J=(TMOD32)\4:GOSUB 809
808 RETURN
809 ON JMOD16+1 GOSUB 810,811,812,813,814,815,816,817:VDP(4)=TMOD32:T=T+1:RETURN
810 POKE&HFAF6,0:CP%=CP%+32:T=CP%+1:FL$=MID$(STR$(T),2):BLOAD FL$,S:GOSUB3000:RETURN
811 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
812 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
813 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
814 POKE&HFAF6,1:FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
815 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
816 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
817 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN


1000 'HMMM command : https://github.com/hra1129/msx_documents/blob/main/vdp/samples/V9938/vdp_hmmm_on_basic/HMMM.BAS
1001 IFVDP(-2)AND1GOTO1001
1010 VDP(33)=SXAND255:VDP(34)=SX\256:VDP(35)=SY:VDP(36)=SP:VDP(37)=DXAND255:VDP(38)=DX\256
1020 VDP(39)=DY:VDP(40)=DP:VDP(41)=NXAND255:VDP(42)=NX\256:VDP(43)=NY:VDP(44)=0:VDP(46)=DR:VDP(47)=&HD0:RETURN

1999 REM SET PALETTE https://nazo.main.jp/prog/retropc/acmsxs3.html
2000 PT=PEEK(&H7)
2010 FOR I=0 TO 15
2020 P1=VPEEK(VP+I*2)
2030 P2=VPEEK(VP+I*2+1)
2040 VDP(17)=I
2050 OUT PT+2,P1
2060 OUT PT+2,P2
2070 NEXT I
2080 RETURN

3000 VP=&H0420:GOSUB 2000:REM SET PALETTE
3010 RETURN