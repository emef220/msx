1 ' Copyright (c) 2	023 emef220 
2 ' Released under the MIT license
3 ' https://opensource.org/licenses/mit-license.php
401 CLS:DEFINTA-Z
411 DIM P%(10,16),Q%(10,16)
412 PT%=PEEK(&H7):W=1:FR%=15:CP%=0:ED%=316
420 COLOR15,0,0:SCREEN5
421 VDP(0)=0:VDP(1)=&H68:VDP(10)=VDP(10) AND &H7F
422 BASE(15)=0:BASE(17)=&H800:T=1
423 VDP(2)=0:VDP(4)=T
424 VDP(9)=VDP(9) OR &H22
425 DEFUSR=&H41:A=USR(0)

431 D=0:W=0:POKE&HFAF6,W
432 I=1+CP%:FL$=MID$(STR$(I),2):BLOAD FL$,S:I=3+I:FL$=MID$(STR$(I),2):BLOAD FL$,S
433 GOSUB 3100:GOSUB 3200
434 DEFUSR=&H44:A=USR(0) 

480 'INTERVAL ON
485 T=1+CP%:ONINTERVAL=FR%GOSUB500:INTERVALON
490 IFINKEY$=""GOTO490 ELSE END

500 VDP(4)=TMOD32
511 T=T+1
512 GOSUB800
520 RETURN

800 ON (T=ED%) + 2 GOSUB 813,802 :RETURN
802 IF TMOD4=0 THEN J=(TMOD32)\4 AND 7:GOSUB 809
808 RETURN
809 ON (J=0)+(J=4)+(J=4)+3 GOSUB 810,811,812:RETURN
810 POKE&HFAF6,1:FL$=MID$(STR$(T),2):BLOAD FL$,S:VDP(4)=TMOD32:T=T+1:RETURN
811 POKE&HFAF6,0:CP%=CP%+32:T=CP%+1:FL$=MID$(STR$(T),2):BLOAD FL$,S:VDP(4)=TMOD32:T=T+1:RETURN
812 FL$=MID$(STR$(T),2):BLOAD FL$,S:VDP(4)=TMOD32:T=T+1:RETURN
813 POKE&HFAF6,0:CP%=0:T=CP%+1:FL$=MID$(STR$(T),2):BLOAD FL$,S:VDP(4)=TMOD32:T=T+1:RETURN

1999 REM SET PALETTE https://nazo.main.jp/prog/retropc/acmsxs3.html
2000 PT=PEEK(&H7)
2010 FOR I=0 TO 15
2020 P1=VPEEK(VP+I*2)
2030 P2=VPEEK(VP+I*2+1)
2040 VDP(17)=I
2050 OUT PT+2,P1
2060 OUT PT+2,P2
2070 NEXT I
2080 RETURN

3000 VP=&H0420:GOSUB 2000:REM SET PALETTE
3010 RETURN

3100 VP=&H0420
3101 FOR T=0TO312STEP32
3102 U=T+1:FL$=MID$(STR$(U),2):BLOAD FL$,S
3103 FOR I=0 TO 15:P1=VPEEK(VP+I*2):P2=VPEEK(VP+I*2+1):P%(T/32,I)=P1:Q%(T/32,I)=P2:NEXTI
3104 NEXT T:RETURN

3200 FOR I=0 TO 15:VDP(17)=I:OUTPT%+2,P%(T/32,I):OUTPT%+2,Q%(T/32,I):NEXTI:RETURN
