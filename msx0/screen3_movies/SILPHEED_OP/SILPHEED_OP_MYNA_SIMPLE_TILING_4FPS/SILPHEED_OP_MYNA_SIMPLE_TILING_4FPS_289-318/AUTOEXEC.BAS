9 ' -------- CREATE PROGRAM.BIN generated at https://nazo.main.jp/prog/retropc/acmsxs3.html  --------
10 CLS:COLOR 15,0,0:SCREEN 5:OPEN "GRP:" FOR OUTPUT AS #1
20 DEFINTA-Z
30 CP%=288
40 VDP(9)=VDP(9)OR22
50 'VP=&H0C20:GOSUB 2000:REM SET PALETTE
60 'SCREEN3.05!
70 VDP(0)=0:VDP(1)=&H68
80 VDP(2)=0:VDP(4)=0
90 VDP(10)=VDP(10) OR &H80

101 SETPAGE,2:BLOAD "PROGRAM.BIN",S
102 'VP=&H0420:GOSUB 2000:REM SET PALETTE
103 SETPAGE,0:PRINT#1,"CONVERT FIRST 32KB"':A$=INPUT$(1)

110 'HMMM 32KB INTO PAGE1
111 SETPAGE,1:CLS
112 SX=0:SY=16:SP=2:DX=0:DY=0:DP=1:NX=256:NY=255:DR=0:GOSUB1000
113 SETPAGE,1
114 FOR  T=1 TO 15
115 GOSUB 200
116 NEXT T
117 SETPAGE,0:PRINT#1,"CONVERT SECOND 32KB"':A$=INPUT$(1)

118 'HMMM NEXT 32KB INTO PAGE1
119 'SETPAGE,1:CLS
120 SX=0:SY=0:SP=3:DX=0:DY=0:DP=1:NX=256:NY=255:DR=0:GOSUB1000
121 SETPAGE,1
122 FOR  T=16 TO 31
123 GOSUB 200
124 NEXT T
125 'END
126 GOTO 400

200 'BSAVE AS 8KB BLOCKS IN SCREEN 5
201 IF TMOD32 = 1 THEN GOSUB 220
202 IF TMOD8=0 THEN J=(TMOD32)\8:GOSUB 209
203 RETURN
209 ON JMOD8+1 GOSUB 211,213,215,217 : RETURN
211 I=T+CP%:ST%=&H0:ED%=&H1FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S
212 I=I+4:ST%=&H2000:ED%=&H3FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S:RETURN

213 I=T+CP%:ST%=&H4000:ED%=&H5FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S
214 I=I+4:ST%=&H6000:ED%=&H7FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S:RETURN

215 I=T+CP%:ST%=&H0:ED%=&H1FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S
216 I=I+4:ST%=&H2000:ED%=&H3FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S:RETURN

217 I=T+CP%:ST%=&H4000:ED%=&H5FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S
218 I=I+4:ST%=&H6000:ED%=&H7FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S:RETURN

220 I=T+CP%:ST%=&H000:ED%=&H1FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S
221 I=I+3:ST%=&H2000:ED%=&H3FFF:FL$=MID$(STR$(I),2):BSAVE FL$,ST%,ED%,S:RETURN

400 ' -------- PLAY THE MOVIE   --------
401 CLS
411 FR%=15
412 D=0:W=1
413 SETPAGE,0:PRINT#1,"PLAY MOVIE WITH INTERVAL="FR%':A$=INPUT$(1)
420 COLOR15,0,0:SCREEN5
421 VDP(0)=0:VDP(1)=&H68:VDP(10)=VDP(10) AND &H7F
422 BASE(15)=0:BASE(17)=&H800:T=1
423 VDP(2)=0:VDP(4)=T
424 VDP(9)=VDP(9) OR &H22
425 DEFUSR=&H41:A=USR(0)

431 D=0:W=0:POKE&HFAF6,W
432 I=1+CP%:FL$=MID$(STR$(I),2):BLOAD FL$,S:I=3+I:FL$=MID$(STR$(I),2):BLOAD FL$,S
433 DEFUSR=&H44:A=USR(0) 

450 'SET PALLET
460 GOSUB 3000

480 'INTERVAL ON
485 T=1+CP%:ONINTERVAL=FR%GOSUB500:INTERVALON
490 IFINKEY$=""GOTO490 ELSE END

500 VDP(4)=TMOD32
511 T=T+1
512 GOSUB700
520 RETURN

700 IF T=CP%+31 THEN POKE&HFAF6,0:T=CP%+1:FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
705 GOSUB 800
720 RETURN

800 IF TMOD4=0 THEN J=(TMOD32)\4:GOSUB 809
808 RETURN
809 ON JMOD16+1 GOSUB 810,811,812,813,814,815,816,817:VDP(4)=TMOD32:T=T+1:RETURN
810 POKE&HFAF6,0:CP%=CP%+0:T=CP%+1:FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
811 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
812 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
813 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
814 POKE&HFAF6,1:FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
815 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
816 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN
817 FL$=MID$(STR$(T),2):BLOAD FL$,S:RETURN


1000 'HMMM command : https://github.com/hra1129/msx_documents/blob/main/vdp/samples/V9938/vdp_hmmm_on_basic/HMMM.BAS
1001 IFVDP(-2)AND1GOTO1001
1010 VDP(33)=SXAND255:VDP(34)=SX\256:VDP(35)=SY:VDP(36)=SP:VDP(37)=DXAND255:VDP(38)=DX\256
1020 VDP(39)=DY:VDP(40)=DP:VDP(41)=NXAND255:VDP(42)=NX\256:VDP(43)=NY:VDP(44)=0:VDP(46)=DR:VDP(47)=&HD0:RETURN

1999 REM SET PALETTE https://nazo.main.jp/prog/retropc/acmsxs3.html
2000 PT=PEEK(&H7)
2010 FOR I=0 TO 15
2020 P1=VPEEK(VP+I*2)
2030 P2=VPEEK(VP+I*2+1)
2040 VDP(17)=I
2050 OUT PT+2,P1
2060 OUT PT+2,P2
2070 NEXT I
2080 RETURN

3000 VP=&H0420:GOSUB 2000:REM SET PALETTE
3010 RETURN